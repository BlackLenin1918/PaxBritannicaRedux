on_actions = {
	#### PEACE/WAR VICTORY ON_CAPITULATION BLOCK ####
	#### PUT YOUR SHIT HERE
	# At the end of each global block, set the skip_default_capitulation GLOBAL flag
	# go away stinky vanilla peace

	# FROM = winner 
	# ROOT = country being capitulated/loser
	on_capitulation = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation"

			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			#Annexation block
			# this will only trigger ROOT (the loser) is in a faction and is NOT the only survivor of said faction
			# if ROOT is the only survivor then it will trigger the proper effects below
			if = {
				limit = {
					NOT = {
						ROOT = {
							is_in_faction = yes
							any_other_country = {
								is_in_faction_with = PREV
								has_capitulated = no
							}
						}
					}
				}
				set_global_flag = war_won
				# normal peace stuff
				

				if = { # Malaysian insurguncy - Defeat
					limit = {
						FROM = {
							has_country_flag = PB_WAR_SYSTEM_Malaysian_Insurgency
							original_tag = KAL
						}
						ROOT = {
							has_country_flag = PB_WAR_SYSTEM_Malaysian_Insurgency
							original_tag = MAL
						}
					}

					FROM = {
						country_event = {
							id = waroutcome.1
						}
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}	
				if = { # Malaysian insurguncy - Victory
					limit = {
						FROM = {
							has_country_flag = PB_WAR_SYSTEM_Malaysian_Insurgency
							original_tag = MAL
						}
						ROOT = {
							has_country_flag = PB_WAR_SYSTEM_Malaysian_Insurgency
							original_tag = KAL
						}
					}

					FROM = {
						country_event = {
							id = waroutcome.2
						}

						white_peace = ROOT

						drop_cosmetic_tag = yes
					}
					set_global_flag = skip_default_capitulation
				}	
				if = { # Slovakian Revolution - Defeat
					limit = {
						FROM = {
							has_country_flag = PB_WAR_SYSTEM_Slovakian_Revolution
							OR = {
								original_tag = HUN
								original_tag = SLO
								original_tag = CRO
							}
						}
						ROOT = {
							has_country_flag = PB_WAR_SYSTEM_Slovakian_Revolution
							original_tag = SLO
						}
					}

					FROM = {
						country_event = {
							id = waroutcome.3
						}
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}	
				if = { # Slovakian Revolution - Victory
					limit = {
						FROM = {
							has_country_flag = PB_WAR_SYSTEM_Slovakian_Revolution
							original_tag = SLO
						}
						ROOT = {
							has_country_flag = PB_WAR_SYSTEM_Slovakian_Revolution
							OR = {
								original_tag = HUN
								original_tag = CRO
							}
						}
					}

					FROM = {
						country_event = {
							id = waroutcome.4
						}

						white_peace = ROOT

						drop_cosmetic_tag = yes
					}
					set_global_flag = skip_default_capitulation
				}	

				if = { # Irish Secession Crisis - Loyalist Victory
					limit = {
						FROM = {
							OR = {
								original_tag = IRE
								original_tag = ENG
							}
						}
						ROOT = {
							original_tag = ICA
						}
					}

					IRE = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}	

				if = { # Chinese Civil War - Qing Victory
					limit = {
						FROM = {
							original_tag = CHI
						}
						ROOT = {
							original_tag = ROC
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Chinese Civil War - Republican Victory
					limit = {
						FROM = {
							original_tag = ROC
						}
						ROOT = {
							original_tag = CHI
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

                if = { # LAK SCA War - SCA Win
					limit = {
						FROM = {
							original_tag = SCA
						}
						ROOT = {
							original_tag = LAK
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

                if = { # LAK SCA War - LAK Win
					limit = {
						FROM = {
							original_tag = LAK
						}
						ROOT = {
							original_tag = SCA
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

                if = { # American Southern Uprising - FSA Defeat
					limit = {
						FROM = {
							original_tag = AME
						}
						ROOT = {
							original_tag = FSA
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

                if = { # American Southern Uprising - FSA Victory
					limit = {
						FROM = {
							original_tag = FSA
						}
						ROOT = {
							original_tag = AME
						}
					}

					FROM = {
						white_peace = ROOT 
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Great Balkan War - Entente Victory
					limit = {
						FROM = {
							has_global_flag = Great_Balkan_War_Fired
							original_tag = HUN
						}
						ROOT = {
							has_global_flag = Great_Balkan_War_Fired
							OR = {
								original_tag = SER
								original_tag = ROM
							}
						}
					}

					FROM = {
						white_peace = ROOT
					}

					HUN = {
						country_event = { id = balkwar.10 } 
					}
					BUL = {
						country_event = { id = balkwar.18 } 
					}
					CRO = {
						country_event = { id = balkwar.18 } 
					}

					clr_global_flag = Great_Balkan_War_Fired
					set_global_flag = Great_Balkan_War_Finished
				}
					set_global_flag = skip_default_capitulation

				if = { # Great Balkan War - Anti-Hungarian Victory
					limit = {
						FROM = {
							has_global_flag = Great_Balkan_War_Fired
							OR = {
								original_tag = SER
								original_tag = ROM
							}
						}
						ROOT = {
							has_global_flag = Great_Balkan_War_Fired
							original_tag = HUN
						}
					}

					FROM = {
						white_peace = ROOT
					}

					SER = {
						country_event = { id = balkwar.15 } 
					}
					ROM = {
						country_event = { id = balkwar.18 } 
					}

					clr_global_flag = Great_Balkan_War_Fired
					set_global_flag = Great_Balkan_War_Finished

				}
					set_global_flag = skip_default_capitulation


				if = { # Chinese Civil War - Russian Invasion of Mongolia
					limit = {
						FROM = {
							original_tag = RUS
						}
						ROOT = {
							original_tag = MON
						}
					}

					FROM = {
						white_peace = ROOT
						set_autonomy = {
							target = MON
							autonomous_state = autonomy_PB_Imperial_Autonomy
							freedom_level = 0.5
						}
						
					}

					MON = {
						transfer_state = 321
						transfer_state = 297
						transfer_state = 330

						set_politics = { 
							ruling_party = ds
							elections_allowed = no 
						}

						add_popularity = {
							ideology = ds
							popularity = 0.05
						}

						create_country_leader = {
							name = "Demchugdongrub"
							desc = "POLITICS_MOHAMMED_ZAHIR_SHAH_DESC"
							picture = "Portrait_MON_Demchugdongrub.dds"
							ideology = DS_VARIANT_06
						}

						set_cosmetic_tag = MON_RUS_Nationalists
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Chinese Civil War - Russian Invasion of Manchuria
					limit = {
						FROM = {
							original_tag = RUS
						}
						ROOT = {
							original_tag = MAN
						}
					}

					FROM = {
						white_peace = ROOT
						set_autonomy = {
							target = MAN
							autonomous_state = autonomy_PB_Imperial_Autonomy
							freedom_level = 0.5
						}
					}

					MAN = {
						transfer_state = 610
						transfer_state = 716
						transfer_state = 328
						transfer_state = 715
						transfer_state = 714
						transfer_state = 717
						transfer_state = 761

						set_politics = { 
							ruling_party = ds
							elections_allowed = no 
						}

						add_popularity = {
							ideology = ds
							popularity = 0.05
						}

						create_country_leader = {
							name = "Zhang Jinghui"
							desc = "POLITICS_MOHAMMED_ZAHIR_SHAH_DESC"
							picture = "Portrait_MAN_Zhang_Jinghui.dds"
							ideology = DS_VARIANT_01
						}

						set_cosmetic_tag = MAN_RUS_Puppet
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Chinese Civil War - Central Plains War - Xebei Victory
					limit = {
						FROM = {
							original_tag = XSM
						}
						ROOT = {
							original_tag = FTR
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Chinese Civil War - Central Plains War - Free Territory Victory
					limit = {
						FROM = {
							original_tag = FTR
						}
						ROOT = {
							original_tag = XSM
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Turkish Civil War - GENERAL CAPITULATION
					limit = {
						FROM = {
							OR = {
								original_tag = TUR
								original_tag = NTR
								original_tag = RTR
							}
						}
						ROOT = {
							OR = {
								original_tag = TUR
								original_tag = NTR
								original_tag = RTR
							}
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Arab Wars
					limit = {
						FROM = {
							OR = {
								original_tag = HEJ
								original_tag = JBS
								original_tag = JOR
								original_tag = SYR
								original_tag = MIQ
								original_tag = YEM
								original_tag = IKW
								original_tag = UAR
							}
						}
						ROOT = {
							OR = {
								original_tag = HEJ
								original_tag = JBS
								original_tag = JOR
								original_tag = SYR
								original_tag = MIQ
								original_tag = YEM
								original_tag = IKW
								original_tag = UAR
							}
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # British Africa Algeria Invasion
					limit = {
						FROM = {
							original_tag = BAF
						}
						ROOT = {
							OR = {
								original_tag = ALG
								original_tag = FRG
							}
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # South African War - German Victory
					limit = {
						FROM = {
							original_tag = SDW
						}
						ROOT = {
							OR = {
								original_tag = NAT
								original_tag = GOS
								original_tag = NRP
								original_tag = ORJ
							}
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}

					SDW = {
						country_event = { id = south_africa.14 } 
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # South African War - German Defeat
					limit = {
						FROM = {
							OR = {
								original_tag = NAT
								original_tag = GOS
								original_tag = NRP
								original_tag = ORJ
							}
						}
						ROOT = {
							original_tag = SDW
						}
					}

					FROM = {
						white_peace = ROOT
					}

					SDW = {
						country_event = { id = south_africa.15 } 
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # South African War - Natalia Victory
					limit = {
						FROM = {
							OR = {
								original_tag = NAT
								original_tag = GOS
							}
						}
						ROOT = {
							OR = {
								original_tag = NRP
								original_tag = ORJ
							}
						}
					}
					FROM = {
						white_peace = ROOT
					}
					NAT = {
						annex_country = {
					 		target = NRP
					 		transfer_troops = no
					 	}
						annex_country = {
					 		target = ORJ
					 		transfer_troops = no
					 	}
						 country_event = { id = south_africa.16 } 
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # South African War - New Republic Victory
					limit = {
						FROM = {
							OR = {
								original_tag = NRP
								original_tag = ORJ
							}
						}
						ROOT = {
							OR = {
								original_tag = NAT
								original_tag = GOS
							}
						}
					}

					FROM = {
						white_peace = ROOT
					}

					NRP = {
						country_event = { id = south_africa.17 } 
						annex_country = {
					 		target = NAT
					 		transfer_troops = no
					 	}
						annex_country = {
					 		target = GOS
					 		transfer_troops = no
					 	}
					}

					set_global_flag = skip_default_capitulation
				}

				if = { # French Conquests
					limit = {
						FROM = {
							original_tag = FRA
						}
						ROOT = {
							OR = {
								original_tag = BRT
								original_tag = WLA
								original_tag = HOL
							}
						}
					}

					FROM = {
						white_peace = ROOT
						annex_country = {
					 		target = ROOT
					 		transfer_troops = no
					 	}
					}
					set_global_flag = skip_default_capitulation
				}

				if = { # Turkish Civil War - Capitulation Checker
					limit = {
						FROM = {
							OR = {
								tag = TUR
								tag = RTR
								tag = NTR
								tag = KRD
							}
							has_global_flag = Turkish_civil_war_occuring
						}
						ROOT = {
							OR = {
								tag = TUR
								tag = RTR
								tag = NTR
								tag = KRD
							}
							has_global_flag = Turkish_civil_war_occuring
						}
					}
					TUR_turkish_civil_war_off_a_fucker = yes
					FROM = {
						white_peace = ROOT
						annex_country = {
							 target = ROOT
							 transfer_troops = no
						 }
					}
					set_global_flag = skip_default_capitulation
				}
				#Capitulation block
				set_global_flag = war_continuing
			}
			clr_global_flag = skip_default_capitulation
		}
	}
	#Armchair historian of wars
	on_declare_war = {
		effect = {
			log="[GetDateText]: [Root.GetName] declared war on [From.GetName]"
		}
	}
}
